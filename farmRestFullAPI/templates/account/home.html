{% extends "base.html" %}
{% block title %}Home{% endblock %}

{% block content %}
<!-- page-wrapper Start-->

<div class="home_content">
  <div class="container">
    <div class="header_dashboard">
      <h1 class="title">Home</h1>
      <h4>Welcome back <span class="name">{{request.user.first_name|default:request.user.username }}</span></h4>
    </div>

    <div class="devices-display">
      <div class="row" id="iot-row">
        <div class="col main-card iot-card">
          <div class="row">
            <div class="col-4 box-iot-icon">
              <div class="border-iot-icon">
                <div class="iot-icon">
                  <img class="tem" src="./../../../media/iot/temperature.png" alt="tem" />
                </div>
              </div>
            </div>
            <div class="col">
              <div class="box-content">
                <span class="title" id="temperature">
                  {{ latest_data.temperature  }}
                </span>
                <span class="content">
                  Temperature (â„ƒ)
                </span>
              </div>
            </div>
          </div>
        </div>
        <div class="col main-card iot-card">
          <div class="row">
            <div class="col-4 box-iot-icon">
              <div class="border-iot-icon">
                <div class="iot-icon">
                  <img class="tem" src="./../../../media/iot/light-sensor.png" alt="tem" />
                </div>
              </div>
            </div>
            <div class="col">
              <div class="box-content">
                <span class="title" id="lightIntensity">

                  {{  latest_data.light_intensity }}
                </span>
                <span class="content">
                  Light Intentsity (%)
                </span>
              </div>
            </div>
          </div>
        </div>
        <div class="col main-card iot-card">
          <div class="row">
            <div class="col-4 box-iot-icon">
              <div class="border-iot-icon">
                <div class="iot-icon">
                  <img class="tem" src="./../../../media/iot/humidity.png" alt="tem" />
                </div>
              </div>
            </div>
            <div class="col">
              <div class="box-content">
                <span class="title" id="soilMoisture">
                  {{ latest_data.soilmoisture  }}
                </span>
                <span class="content">
                  Soil Moisture (%)
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="row ">
        <div class="main-card recent-noti mt-3">
          <h3 class="border-bottom pb-2 mb-0">Recent notification</h3>

          {% for notification in notifications %}
            <div class="box-noti text-muted">
            <div class="d-flex">

              <div class="box-icon">
                <div class="flex-shrink-0 bell-icon ">
                  <i class="fa-regular fa-bell fa-shake"></i>
                </div>
              </div>
              <p class="mb-0 small lh-sm col content">
                <strong class="d-block text-gray-dark">{{notification.username}}</strong>
                {{notification.message}}
              </p>
            </div>

            <div class="time col-2">
              <span>
                 {{notification.created}}
              </span>
            </div>
          </div>
          {% endfor %}

          <small class="d-block text-end mt-3">
          </small>
          {% include "paginator.html" with page=notifications %}
        </div>
      </div>

    </div>
  </div>
</div>
<!-- page-wrapper end-->
<script>
    function updateRoomData() {
        // Make an AJAX request to the Django server endpoint that provides the latest data
        // You might need to adjust the URL and method based on your Django setup
        fetch('/update_room_data/')
            .then(response => response.json())
            .then(data => {
                // Update the value inside the <span> element with the new data
                document.getElementById('soilMoisture').textContent = data.latest_data.soilmoisture;
                document.getElementById('temperature').textContent = data.latest_data.temperature;
                document.getElementById('lightIntensity').textContent = data.latest_data.light_intensity;

            })
            .catch(error => console.error('Error updating soil moisture:', error));
    }

    // Call the function initially and then set up an interval to call it every 10 seconds
    updateRoomData();
    setInterval(updateRoomData, 10000); // 10000 milliseconds = 10 seconds
</script>

{% endblock %}